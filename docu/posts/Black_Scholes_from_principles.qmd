---
title: "Complete Black-Scholes Proofs: From First Principles"
author: ""
date: today
format:
  html:
    toc: true
    toc-depth: 3
    number-sections: true
    html-math-method: mathjax
  pdf:
    toc: true
    number-sections: true
    geometry:
      - top=1in
      - left=1in
      - right=1in
      - bottom=1in
categories:
 - Technical
editor: 
  markdown: 
    wrap: 72
---

# Part I: Mathematical Foundations and Definitions

This section establishes all the mathematical machinery needed for the
Black-Scholes proofs. We assume knowledge of measure theory and basic
stochastic calculus but will define all financial and probabilistic
concepts explicitly.

### Financial Market Framework

::: {.callout-note icon="false"}
### Definition 1.1 (Financial Market)

A financial market consists of:

1.  A probability space $(\Omega, \mathcal{F}, \mathbb{P})$ where
    $\Omega$ represents all possible market scenarios
2.  A filtration $\{\mathcal{F}_t\}_{t \geq 0}$ representing information
    available at time $t$
3.  A finite collection of traded assets with price processes
    $\{S^i_t\}_{i=0,1,\ldots,n}$
:::

::: {.callout-note icon="false"}
### Definition 1.2 (Brownian Motion)

A stochastic process $\{W_t\}_{t \geq 0}$ on
$(\Omega, \mathcal{F}, \mathbb{P})$ is a standard Brownian motion if:

1.  $W_0 = 0$ almost surely
2.  $W$ has independent increments: for $0 \leq s < t$, $W_t - W_s$ is
    independent of $\mathcal{F}_s$
3.  $W_t - W_s \sim N(0, t-s)$ for all $0 \leq s < t$
4.  $W$ has continuous sample paths almost surely
:::

::: {.callout-note icon="false"}
### Definition 1.3 (Natural Filtration of Brownian Motion)

The natural filtration of Brownian motion is
$$\mathcal{F}_t^W = \sigma(W_s : 0 \leq s \leq t)$$ the $\sigma$-algebra
generated by the Brownian motion up to time $t$.
:::

::: {.callout-note icon="false"}
### Definition 1.4 (Adapted Process)

A stochastic process $\{X_t\}_{t \geq 0}$ is adapted to the filtration
$\{\mathcal{F}_t\}$ if $X_t$ is $\mathcal{F}_t$-measurable for all
$t \geq 0$.
:::

::: {.callout-note icon="false"}
### Definition 1.5 (Geometric Brownian Motion)

A process $\{S_t\}_{t \geq 0}$ follows geometric Brownian motion with
parameters $\mu \in \mathbb{R}$ and $\sigma > 0$ if it satisfies the
stochastic differential equation:
$$dS_t = \mu S_t \, dt + \sigma S_t \, dW_t$$ with initial condition
$S_0 > 0$.
:::

::: callout-tip
### Remark 1.1

The explicit solution to geometric Brownian motion is:
$$S_t = S_0 \exp\left(\left(\mu - \frac{\sigma^2}{2}\right)t + \sigma W_t\right)$$
This can be verified using Itô's lemma on $f(t,x) = \ln x$.
:::

### Portfolio and Trading Strategy Concepts

::: {.callout-note icon="false"}
### Definition 1.6 (Trading Strategy)

A trading strategy is a pair of adapted processes $(\phi^0_t, \phi^1_t)$
where:

-   $\phi^0_t$ represents the number of units of the bond held at time
    $t$
-   $\phi^1_t$ represents the number of shares of stock held at time $t$

Both processes must be adapted to the filtration $\{\mathcal{F}_t\}$.
:::

::: {.callout-note icon="false"}
### Definition 1.7 (Portfolio Value)

The value of a portfolio with trading strategy $(\phi^0_t, \phi^1_t)$ at
time $t$ is: $$V_t = \phi^0_t B_t + \phi^1_t S_t$$ where $B_t$ is the
bond price and $S_t$ is the stock price.
:::

::: {.callout-note icon="false"}
### Definition 1.8 (Self-Financing Strategy)

A trading strategy $(\phi^0_t, \phi^1_t)$ is self-financing if:
$$dV_t = \phi^0_t dB_t + \phi^1_t dS_t$$ This means no money is added or
withdrawn from the portfolio; changes in value come only from price
movements of held assets.
:::

::: {.callout-note icon="false"}
### Definition 1.9 (Arbitrage Opportunity)

An arbitrage opportunity is a self-financing trading strategy with:

1.  Initial value $V_0 = 0$
2.  $\mathbb{P}(V_T \geq 0) = 1$ for some time $T > 0$
3.  $\mathbb{P}(V_T > 0) > 0$
:::

::: {.callout-note icon="false"}
### Definition 1.10 (Arbitrage-Free Market)

A market is arbitrage-free if no arbitrage opportunities exist.
:::

### Martingale Theory for Finance

::: {.callout-note icon="false"}
### Definition 1.11 (Martingale)

An adapted process $\{M_t\}_{t \geq 0}$ is a martingale with respect to
filtration $\{\mathcal{F}_t\}$ and probability measure $\mathbb{P}$ if:

1.  $\mathbb{E}[|M_t|] < \infty$ for all $t \geq 0$
2.  $\mathbb{E}[M_t | \mathcal{F}_s] = M_s$ for all $0 \leq s \leq t$
:::

::: {.callout-note icon="false"}
### Definition 1.12 (Equivalent Probability Measures)

Two probability measures $\mathbb{P}$ and $\mathbb{Q}$ on
$(\Omega, \mathcal{F})$ are equivalent (written
$\mathbb{P} \sim \mathbb{Q}$) if they have the same null sets:
$$\mathbb{P}(A) = 0 \iff \mathbb{Q}(A) = 0 \text{ for all } A \in \mathcal{F}$$
:::

::: {.callout-note icon="false"}
### Definition 1.13 (Radon-Nikodym Derivative)

If $\mathbb{Q} \ll \mathbb{P}$ (Q is absolutely continuous with respect
to P), then there exists a non-negative $\mathcal{F}$-measurable random
variable $Z$ such that:
$$\mathbb{Q}(A) = \int_A Z \, d\mathbb{P} \text{ for all } A \in \mathcal{F}$$
We write $Z = \frac{d\mathbb{Q}}{d\mathbb{P}}$ and call $Z$ the
Radon-Nikodym derivative.
:::

::: {.callout-important icon="false"}
### Theorem 1.1 (Girsanov's Theorem - Statement)

Let $\theta$ be an adapted process with
$\int_0^T \theta_s^2 \, ds < \infty$ almost surely. Define:
$$Z_t = \exp\left(-\int_0^t \theta_s \, dW_s - \frac{1}{2}\int_0^t \theta_s^2 \, ds\right)$$

If $\mathbb{E}[Z_T] = 1$, then:

1.  The process $Z_t$ is a martingale
2.  The measure $\mathbb{Q}$ defined by
    $\frac{d\mathbb{Q}}{d\mathbb{P}} = Z_T$ is a probability measure
    equivalent to $\mathbb{P}$
3.  Under $\mathbb{Q}$, the process
    $\tilde{W}_t = W_t + \int_0^t \theta_s \, ds$ is a Brownian motion
:::

::: {.callout-note icon="false"}
### Definition 1.14 (Risk-Neutral Measure)

In a financial market with bond $B_t = e^{rt}$ and stock following
$$dS_t = \mu S_t \, dt + \sigma S_t \, dW_t$$ a probability measure
$\mathbb{Q}$ equivalent to $\mathbb{P}$ is called risk-neutral if the
discounted stock price $e^{-rt}S_t$ is a $\mathbb{Q}$-martingale.
:::

### Options and Derivatives

::: {.callout-note icon="false"}
### Definition 1.15 (European Option)

A European option is a financial contract that gives the holder the
right (but not obligation) to:

-   **Call option**: Buy an asset at strike price $K$ at maturity time
    $T$
-   **Put option**: Sell an asset at strike price $K$ at maturity time
    $T$
:::

::: {.callout-note icon="false"}
### Definition 1.16 (Option Payoff)

The payoff of a European option at maturity $T$ is:

-   **Call**: $h(S_T) = (S_T - K)^+ = \max(S_T - K, 0)$
-   **Put**: $h(S_T) = (K - S_T)^+ = \max(K - S_T, 0)$

where $S_T$ is the stock price at maturity.
:::

::: {.callout-note icon="false"}
### Definition 1.17 (Option Price)

The price of an option at time $t$ is denoted $V(t, S_t)$ and depends on
the current time $t$ and current stock price $S_t$.
:::

::: {.callout-note icon="false"}
### Definition 1.18 (Replicating Portfolio)

A replicating portfolio for an option is a self-financing trading
strategy $(\phi^0_t, \phi^1_t)$ such that the portfolio value at
maturity equals the option payoff:
$$V_T = \phi^0_T B_T + \phi^1_T S_T = h(S_T)$$
:::

### Fundamental Theorems of Asset Pricing

::: {.callout-important icon="false"}
### Theorem 1.2 (First Fundamental Theorem of Asset Pricing)

A market is arbitrage-free if and only if there exists a probability
measure $\mathbb{Q}$ equivalent to $\mathbb{P}$ such that all discounted
asset prices are $\mathbb{Q}$-martingales.
:::

::: {.callout-important icon="false"}
### Theorem 1.3 (Second Fundamental Theorem of Asset Pricing)

An arbitrage-free market is complete if and only if the risk-neutral
measure is unique.
:::

::: {.callout-note icon="false"}
### Definition 1.19 (Complete Market)

A market is complete if every contingent claim (option payoff) can be
replicated by a self-financing trading strategy.
:::

::: {.callout-important icon="false"}
### Theorem 1.4 (Risk-Neutral Valuation Principle)

In an arbitrage-free complete market, the price of any attainable
contingent claim $h(S_T)$ at time $t$ is:
$$V(t, S_t) = e^{-r(T-t)} \mathbb{E}_\mathbb{Q}[h(S_T) | \mathcal{F}_t]$$
where $\mathbb{Q}$ is the unique risk-neutral measure.
:::

## Part II: The Black-Scholes Model Setup

### Model Specification

We consider a financial market on a probability space
$(\Omega, \mathcal{F}, \mathbb{P})$ with filtration
$\{\mathcal{F}_t\}_{t \geq 0}$ and two traded assets:

::: {.callout-note icon="false"}
### Definition 2.1 (Black-Scholes Market Model)

The Black-Scholes market consists of:

1.  **Risk-free bond**: $dB_t = rB_t \, dt$ with $B_0 = 1$, giving
    $B_t = e^{rt}$
2.  **Risky stock**: $dS_t = \mu S_t \, dt + \sigma S_t \, dW_t$ with
    $S_0 > 0$

where:

-   $r > 0$ is the constant risk-free interest rate
-   $\mu \in \mathbb{R}$ is the stock's expected return (drift)
-   $\sigma > 0$ is the stock's volatility
-   $\{W_t\}_{t \geq 0}$ is a standard Brownian motion adapted to
    $\{\mathcal{F}_t\}$
:::

::: {.callout-note icon="false"}
### Definition 2.2 (European Call Option in Black-Scholes Model)

We consider a European call option with:

-   Strike price $K > 0$
-   Maturity time $T > 0$\
-   Payoff at maturity: $h(S_T) = (S_T - K)^+$

Our goal is to find the option price $V(t, S_t)$ for $0 \leq t \leq T$.
:::

### Key Properties of the Model

::: {.callout-important icon="false"}
### Lemma 2.1 (Stock Price Solution)

The solution to the stock price SDE
$dS_t = \mu S_t \, dt + \sigma S_t \, dW_t$ is:
$$S_t = S_0 \exp\left(\left(\mu - \frac{\sigma^2}{2}\right)t + \sigma W_t\right)$$
:::

::: {.callout-note collapse="true"}
### Proof of Lemma 2.1

Let $Y_t = \ln S_t$. By Itô's lemma with $f(x) = \ln x$:

```{=tex}
\begin{align}
dY_t &= f'(S_t) dS_t + \frac{1}{2}f''(S_t)(dS_t)^2 \\
&= \frac{1}{S_t} dS_t + \frac{1}{2}\left(-\frac{1}{S_t^2}\right)(dS_t)^2 \\
&= \frac{1}{S_t}(\mu S_t \, dt + \sigma S_t \, dW_t) - \frac{1}{2S_t^2}(\sigma S_t)^2 dt \\
&= \mu \, dt + \sigma \, dW_t - \frac{\sigma^2}{2} dt \\
&= \left(\mu - \frac{\sigma^2}{2}\right) dt + \sigma \, dW_t
\end{align}
```
Integrating from $0$ to $t$:
$$Y_t = Y_0 + \left(\mu - \frac{\sigma^2}{2}\right)t + \sigma W_t$$

Since $Y_t = \ln S_t$ and $Y_0 = \ln S_0$:
$$\ln S_t = \ln S_0 + \left(\mu - \frac{\sigma^2}{2}\right)t + \sigma W_t$$

Therefore:
$$S_t = S_0 \exp\left(\left(\mu - \frac{\sigma^2}{2}\right)t + \sigma W_t\right)$$
:::

::: {.callout-important icon="false"}
### Corollary 2.1 (Log-Normal Distribution of Stock Price)

Under $\mathbb{P}$, we have:
$$\ln(S_t/S_0) \sim N\left(\left(\mu - \frac{\sigma^2}{2}\right)t, \sigma^2 t\right)$$
:::

## Part III: Proof via Martingale Approach

### Step 1: Construction of Risk-Neutral Measure

::: {.callout-important icon="false"}
### Theorem 3.1 (Existence of Risk-Neutral Measure in Black-Scholes)

There exists a unique probability measure $\mathbb{Q}$ equivalent to
$\mathbb{P}$ such that the discounted stock price $e^{-rt}S_t$ is a
$\mathbb{Q}$-martingale.
:::

::: {.callout-note collapse="true"}
### Proof of Theorem 3.1

**Step 1**: Define the market price of risk:
$$\theta = \frac{\mu - r}{\sigma}$$

This is the constant that will appear in Girsanov's theorem.

**Step 2**: Define the Radon-Nikodym density process: \begin{align}
Z_t &= \exp\left(-\theta W_t - \frac{1}{2}\theta^2 t\right) \\
&= \exp\left(-\frac{\mu - r}{\sigma} W_t - \frac{1}{2}\left(\frac{\mu - r}{\sigma}\right)^2 t\right)
\end{align}

**Step 3**: Verify that $Z_t$ is a martingale and $\mathbb{E}[Z_T] = 1$.

Since $\theta$ is constant, we can compute:
$$\mathbb{E}[Z_t] = \mathbb{E}\left[\exp\left(-\theta W_t - \frac{1}{2}\theta^2 t\right)\right]$$

Since $W_t \sim N(0,t)$ under $\mathbb{P}$: \begin{align}
\mathbb{E}[Z_t] &= \int_{-\infty}^{\infty} \exp\left(-\theta w - \frac{1}{2}\theta^2 t\right) \frac{1}{\sqrt{2\pi t}} \exp\left(-\frac{w^2}{2t}\right) dw \\
&= \exp\left(-\frac{1}{2}\theta^2 t\right) \int_{-\infty}^{\infty} \frac{1}{\sqrt{2\pi t}} \exp\left(-\frac{w^2 + 2\theta tw}{2t}\right) dw \\
&= \exp\left(-\frac{1}{2}\theta^2 t\right) \int_{-\infty}^{\infty} \frac{1}{\sqrt{2\pi t}} \exp\left(-\frac{(w + \theta t)^2 - \theta^2 t^2}{2t}\right) dw \\
&= \exp\left(-\frac{1}{2}\theta^2 t\right) \exp\left(\frac{1}{2}\theta^2 t\right) \int_{-\infty}^{\infty} \frac{1}{\sqrt{2\pi t}} \exp\left(-\frac{(w + \theta t)^2}{2t}\right) dw \\
&= 1
\end{align}

The last integral equals 1 since it's the integral of a normal density.

**Step 4**: Define $\mathbb{Q}$ by
$\frac{d\mathbb{Q}}{d\mathbb{P}} = Z_T$.

**Step 5**: Apply Girsanov's theorem. Under $\mathbb{Q}$, the process:
$$\tilde{W}_t = W_t + \int_0^t \theta \, ds = W_t + \theta t$$ is a
$\mathbb{Q}$-Brownian motion.

**Step 6**: Transform the stock price dynamics. Under $\mathbb{Q}$:
\begin{align}
dS_t &= \mu S_t \, dt + \sigma S_t \, dW_t \\
&= \mu S_t \, dt + \sigma S_t (d\tilde{W}_t - \theta \, dt) \\
&= \mu S_t \, dt + \sigma S_t \, d\tilde{W}_t - \sigma S_t \theta \, dt \\
&= (\mu - \sigma\theta) S_t \, dt + \sigma S_t \, d\tilde{W}_t \\
&= \left(\mu - \sigma \cdot \frac{\mu - r}{\sigma}\right) S_t \, dt + \sigma S_t \, d\tilde{W}_t \\
&= r S_t \, dt + \sigma S_t \, d\tilde{W}_t
\end{align}

**Step 7**: Verify the martingale property. The discounted stock price
is: $$e^{-rt}S_t$$

Its differential is: \begin{align}
d(e^{-rt}S_t) &= -re^{-rt}S_t \, dt + e^{-rt} dS_t \\
&= -re^{-rt}S_t \, dt + e^{-rt}(rS_t \, dt + \sigma S_t \, d\tilde{W}_t) \\
&= e^{-rt}\sigma S_t \, d\tilde{W}_t
\end{align}

Since this has no $dt$ term, $e^{-rt}S_t$ is a $\mathbb{Q}$-martingale.
:::

::: {.callout-note collapse="true"}
### Why Do We Need the Risk-Neutral Measure $\mathbb{Q}$ at All?

This fundamental question gets to the heart of mathematical finance. The
answer reveals why the risk-neutral measure is not just a mathematical
convenience, but an essential concept for correct option pricing.

##### The Fundamental Problem with the Physical Measure $\mathbb{P}$

Under the physical measure $\mathbb{P}$, the stock follows:
$$dS_t = \mu S_t dt + \sigma S_t dW_t$$

If we naively tried to price the option directly under $\mathbb{P}$:
$$V(0, S_0) = e^{-rT} \mathbb{E}_\mathbb{P}[(S_T - K)^+]$$

**This formula is fundamentally incorrect!** Here's why:

###### Issue 1: The Discount Rate Problem

The expectation under $\mathbb{P}$ gives us the expected payoff in the
"real world" where the stock has expected return $\mu$. But what
discount rate should we use?

-   If $\mu > r$: The stock is expected to grow faster than the
    risk-free rate
-   We might think we should discount at rate $\mu$, not $r$
-   But the option's risk profile is completely different from the
    stock's risk profile
-   The appropriate discount rate for the option depends on its specific
    risk characteristics

**The key insight**: We don't know what discount rate to use for the
option under $\mathbb{P}$ because the option's risk premium is unclear
and depends on complex risk preferences.

###### Issue 2: Risk Premium Confusion

Under the physical measure $\mathbb{P}$: - The stock earns expected
return $\mu$ - The bond earns certain return $r$ - The difference
$\mu - r$ is the equity risk premium

But the option has a completely different risk profile than the stock!
Its appropriate risk premium is not obvious and would require knowledge
of: - Investor risk preferences - The option's correlation with market
factors - The option's beta relative to various risk factors

##### Why the Risk-Neutral Measure $\mathbb{Q}$ Solves This Elegantly

The brilliant insight is to change to a probability measure where **all
assets have the same expected return** equal to the risk-free rate.

###### Under $\mathbb{Q}$:

-   Stock expected return: $r$
-   Bond expected return: $r$
-   **Any derivative's expected return:** $r$

This means we can discount everything at the risk-free rate $r$!

$$V(0, S_0) = e^{-rT} \mathbb{E}_\mathbb{Q}[(S_T - K)^+]$$

Now the formula is correct because: 1. The expected return of the option
under $\mathbb{Q}$ is exactly $r$ 2. So we discount at rate $r$ 3. The
mathematics works out perfectly 4. No risk premiums need to be
determined

##### The Economic Intuition

Think of the two measures this way:

**Physical measure** $\mathbb{P}$: *"What will actually happen in the
real world?"* - Stocks have risk premiums reflecting investor risk
aversion - Different assets have different expected returns - Discount
rates are asset-specific and difficult to determine - Requires knowledge
of risk preferences and market prices of risk

**Risk-neutral measure** $\mathbb{Q}$: *"What would happen in a
hypothetical world where all investors are risk-neutral?"* - All assets
earn the risk-free rate in expectation - No risk premiums exist -
Everything can be discounted at the same rate $r$ - Completely bypasses
the need to know risk preferences

##### The Arbitrage Connection

The risk-neutral measure exists precisely because there are no arbitrage
opportunities. Here's the fundamental logic:

1.  **No arbitrage** ⟺ **Risk-neutral measure exists** (First
    Fundamental Theorem of Asset Pricing)
2.  If we can replicate the option with a portfolio of stock and bonds,
    then the option price must equal the portfolio value (no arbitrage
    principle)
3.  The replicating portfolio approach automatically gives us the
    risk-neutral valuation
4.  The $\mathbb{Q}$ measure is the unique measure that makes this work

##### A Concrete Example

Consider a simple one-period binomial model:

**Setup:** - Stock price: $S_0 = 100$ - Up move: $S_1 = 120$ with
probability $p = 0.6$ under $\mathbb{P}$ - Down move: $S_1 = 80$ with
probability $1-p = 0.4$ under $\mathbb{P}$ - Risk-free rate: $r = 5\%$

**Under** $\mathbb{P}$: Expected stock return is
$0.6 \times 20\% + 0.4 \times (-20\%) = 4\%$

**For a call option with** $K = 100$: - Payoff if stock goes up:
$\max(120-100, 0) = 20$ - Payoff if stock goes down:
$\max(80-100, 0) = 0$

###### Wrong Approach (using $\mathbb{P}$):

$$V_0 = \frac{0.6 \times 20 + 0.4 \times 0}{1.05} = \frac{12}{1.05} = 11.43$$

This is incorrect because we're using the wrong probabilities for
discounting at the risk-free rate.

###### Correct Approach (using $\mathbb{Q}$):

First, find the risk-neutral probabilities. Under $\mathbb{Q}$, the
stock must have expected return equal to the risk-free rate $r = 5\%$:

$$q \times 120 + (1-q) \times 80 = 100 \times 1.05 = 105$$
$$40q + 80 = 105$$ $$q = 0.625$$

Now we can price correctly:
$$V_0 = \frac{0.625 \times 20 + 0.375 \times 0}{1.05} = \frac{12.5}{1.05} = 11.90$$

The risk-neutral approach gives the unique arbitrage-free price!

###### Verification by Replication:

We can verify this is correct by constructing a replicating portfolio: -
Buy $\Delta$ shares of stock - Invest $B$ in bonds

Portfolio value in up state: $120\Delta + 1.05B = 20$ Portfolio value in
down state: $80\Delta + 1.05B = 0$

Solving: $\Delta = 0.5$, $B = -38.10$

Initial portfolio cost: $100 \times 0.5 - 38.10 = 11.90$ ✓

##### Why This Matters for Black-Scholes

In the Black-Scholes framework:

1.  **Physical measure**: Stock has drift $\mu$, but option pricing
    would require determining the option's risk premium
2.  **Risk-neutral measure**: Stock has drift $r$, and option pricing
    becomes a pure expectation calculation
3.  **Girsanov's theorem**: Provides the mathematical machinery to
    change from $\mathbb{P}$ to $\mathbb{Q}$
4.  **Hedging connection**: The $\mathbb{Q}$ measure emerges naturally
    from the delta-hedging argument

##### Summary: Why We Need $\mathbb{Q}$

The risk-neutral measure is essential because it:

1.  **Eliminates risk premium confusion** - all assets earn rate $r$ in
    expectation
2.  **Provides the correct discount rate** - always the risk-free rate
    $r$
3.  **Gives the unique arbitrage-free approach** - guaranteed by
    fundamental theorems
4.  **Connects to replication strategies** - matches the hedging-based
    derivation perfectly
5.  **Makes pricing computationally tractable** - turns complex pricing
    into expectation calculations
6.  **Bypasses investor preferences** - no need to know risk aversion
    parameters
7.  **Ensures market completeness** - works for any derivative in a
    complete market

**The key insight**: The risk-neutral measure is not about what will
actually happen in reality - it's about finding the unique
arbitrage-free price in a mathematically elegant and practically
implementable way. It transforms the complex problem of determining
risk-adjusted discount rates into the simpler problem of computing
expectations under an artificial but mathematically convenient
probability measure.
:::

### Step 2: Stock Price Under Risk-Neutral Measure

::: {.callout-important icon="false"}
### Lemma 3.1 (Stock Price Solution Under $\mathbb{Q}$)

Under the risk-neutral measure $\mathbb{Q}$, the stock price has the
explicit form:
$$S_t = S_0 \exp\left(\left(r - \frac{\sigma^2}{2}\right)t + \sigma \tilde{W}_t\right)$$
where $\tilde{W}_t$ is a $\mathbb{Q}$-Brownian motion.
:::

::: {.callout-note collapse="true"}
### Proof of Lemma 3.1

Under $\mathbb{Q}$, the stock follows:
$$dS_t = rS_t \, dt + \sigma S_t \, d\tilde{W}_t$$

Using the same technique as in the original measure, let
$Y_t = \ln S_t$: \begin{align}
dY_t &= \frac{1}{S_t} dS_t - \frac{1}{2S_t^2}(dS_t)^2 \\
&= \frac{1}{S_t}(rS_t \, dt + \sigma S_t \, d\tilde{W}_t) - \frac{1}{2S_t^2}(\sigma S_t)^2 dt \\
&= r \, dt + \sigma \, d\tilde{W}_t - \frac{\sigma^2}{2} dt \\
&= \left(r - \frac{\sigma^2}{2}\right) dt + \sigma \, d\tilde{W}_t
\end{align}

Integrating:
$$Y_t = Y_0 + \left(r - \frac{\sigma^2}{2}\right)t + \sigma \tilde{W}_t$$

Therefore:
$$S_t = S_0 \exp\left(\left(r - \frac{\sigma^2}{2}\right)t + \sigma \tilde{W}_t\right)$$
:::

### Step 3: Risk-Neutral Valuation

::: {.callout-important icon="false"}
### Theorem 3.2 (Risk-Neutral Option Pricing)

The price of the European call option at time $t$ is:
$$V(t, S_t) = e^{-r(T-t)} \mathbb{E}_\mathbb{Q}[(S_T - K)^+ | \mathcal{F}_t]$$
:::

::: {.callout-note collapse="true"}
### Proof of Theorem 3.2

This follows directly from the risk-neutral valuation principle. In an
arbitrage-free complete market, the option price equals the discounted
expected payoff under the risk-neutral measure.
:::

### Step 4: Computing the Expectation

::: {.callout-important icon="false"}
### Theorem 3.3 (Black-Scholes Formula via Martingale Method)

The European call option price is:
$$V(t, S_t) = S_t \Phi(d_1) - K e^{-r(T-t)} \Phi(d_2)$$ where:
\begin{align}
d_1 &= \frac{\ln(S_t/K) + (r + \sigma^2/2)(T-t)}{\sigma\sqrt{T-t}} \\
d_2 &= d_1 - \sigma\sqrt{T-t} = \frac{\ln(S_t/K) + (r - \sigma^2/2)(T-t)}{\sigma\sqrt{T-t}}
\end{align} and $\Phi$ is the cumulative distribution function of the
standard normal distribution.
:::

::: {.callout-note collapse="true"}
### Proof of Theorem 3.3

**Step 1**: Express the stock price at maturity. Under $\mathbb{Q}$,
using the strong Markov property:
$$S_T = S_t \exp\left(\left(r - \frac{\sigma^2}{2}\right)(T-t) + \sigma (\tilde{W}_T - \tilde{W}_t)\right)$$

Since $\tilde{W}_T - \tilde{W}_t \sim N(0, T-t)$ under $\mathbb{Q}$, let
$Z \sim N(0,1)$. Then:
$$S_T = S_t \exp\left(\left(r - \frac{\sigma^2}{2}\right)(T-t) + \sigma\sqrt{T-t} \cdot Z\right)$$

**Step 2**: Set up the expectation. \begin{align}
V(t, S_t) &= e^{-r(T-t)} \mathbb{E}_\mathbb{Q}[(S_T - K)^+ | \mathcal{F}_t] \\
&= e^{-r(T-t)} \mathbb{E}_\mathbb{Q}\left[\left(S_t e^{(r-\sigma^2/2)(T-t) + \sigma\sqrt{T-t} Z} - K\right)^+\right]
\end{align}

**Step 3**: Find the exercise region. The option is exercised when
$S_T > K$, i.e., when:
$$S_t e^{(r-\sigma^2/2)(T-t) + \sigma\sqrt{T-t} Z} > K$$

Taking logarithms: \begin{align}
&(r-\sigma^2/2)(T-t) + \sigma\sqrt{T-t} Z > \ln(K/S_t) \\
&Z > \frac{\ln(K/S_t) - (r-\sigma^2/2)(T-t)}{\sigma\sqrt{T-t}} = -d_2
\end{align}

**Step 4**: Evaluate the integral. \begin{align}
V(t, S_t) &= e^{-r(T-t)} \int_{-d_2}^{\infty} \left(S_t e^{(r-\sigma^2/2)(T-t) + \sigma\sqrt{T-t} z} - K\right) \\
&\quad \times \frac{1}{\sqrt{2\pi}} e^{-z^2/2} dz \\
&= e^{-r(T-t)} S_t e^{(r-\sigma^2/2)(T-t)} \int_{-d_2}^{\infty} e^{\sigma\sqrt{T-t} z} \frac{1}{\sqrt{2\pi}} e^{-z^2/2} dz \\
&\quad - e^{-r(T-t)} K \int_{-d_2}^{\infty} \frac{1}{\sqrt{2\pi}} e^{-z^2/2} dz
\end{align}

**Step 5**: Evaluate the first integral. For the first integral,
complete the square in the exponent:
$$\sigma\sqrt{T-t} z - \frac{z^2}{2} = -\frac{1}{2}(z - \sigma\sqrt{T-t})^2 + \frac{\sigma^2(T-t)}{2}$$

Therefore: \begin{align}
&\int_{-d_2}^{\infty} e^{\sigma\sqrt{T-t} z} \frac{1}{\sqrt{2\pi}} e^{-z^2/2} dz \\
&= e^{\sigma^2(T-t)/2} \int_{-d_2}^{\infty} \frac{1}{\sqrt{2\pi}} e^{-(z-\sigma\sqrt{T-t})^2/2} dz \\
&= e^{\sigma^2(T-t)/2} \int_{-d_2-\sigma\sqrt{T-t}}^{\infty} \frac{1}{\sqrt{2\pi}} e^{-u^2/2} du \\
&= e^{\sigma^2(T-t)/2} \Phi(d_2 + \sigma\sqrt{T-t}) \\
&= e^{\sigma^2(T-t)/2} \Phi(d_1)
\end{align}

where we used the substitution $u = z - \sigma\sqrt{T-t}$ and the fact
that: $$d_2 + \sigma\sqrt{T-t} = d_1$$

**Step 6**: Evaluate the second integral.
$$\int_{-d_2}^{\infty} \frac{1}{\sqrt{2\pi}} e^{-z^2/2} dz = \Phi(d_2)$$

**Step 7**: Combine the results. \begin{align}
V(t, S_t) &= e^{-r(T-t)} S_t e^{(r-\sigma^2/2)(T-t)} e^{\sigma^2(T-t)/2} \Phi(d_1) - e^{-r(T-t)} K \Phi(d_2) \\
&= S_t e^{-r(T-t)} e^{(r-\sigma^2/2)(T-t)} e^{\sigma^2(T-t)/2} \Phi(d_1) - K e^{-r(T-t)} \Phi(d_2) \\
&= S_t e^{-r(T-t) + r(T-t) - \sigma^2(T-t)/2 + \sigma^2(T-t)/2} \Phi(d_1) - K e^{-r(T-t)} \Phi(d_2) \\
&= S_t \Phi(d_1) - K e^{-r(T-t)} \Phi(d_2)
\end{align}
:::

## Part IV: Proof via PDE Approach

### Step 1: Delta Hedging Strategy

::: {.callout-note icon="false"}
### Definition 4.1 (Delta Hedging Portfolio)

Consider a portfolio $\Pi_t$ consisting of:

-   Long position: 1 unit of the option with value $V(t, S_t)$
-   Short position: $\Delta_t$ shares of the stock
-   Cash position: The remaining value invested in bonds

The portfolio value is: $\Pi_t = V(t, S_t) - \Delta_t S_t$
:::

::: {.callout-note icon="false"}
### Definition 4.2 (Delta)

The delta $\Delta_t$ represents the hedge ratio - the number of shares
of stock to short for each option held. We will determine $\Delta_t$ to
make the portfolio risk-free.
:::

### Step 2: Application of Itô's Lemma to Option Value

::: {.callout-important icon="false"}
### Lemma 4.1 (Stochastic Differential of Option Value)

Assume the option price has the form $V(t, S_t)$ where
$V \in C^{1,2}([0,T] \times (0,\infty))$. Then by Itô's lemma:
\begin{align}
dV &= \frac{\partial V}{\partial t} dt + \frac{\partial V}{\partial S} dS_t + \frac{1}{2}\frac{\partial^2 V}{\partial S^2} (dS_t)^2 \\
&= \left[\frac{\partial V}{\partial t} + \mu S_t \frac{\partial V}{\partial S} + \frac{1}{2}\sigma^2 S_t^2 \frac{\partial^2 V}{\partial S^2}\right] dt + \sigma S_t \frac{\partial V}{\partial S} dW_t
\end{align}
:::

::: {.callout-note collapse="true"}
### Proof of Lemma 4.1

Since $dS_t = \mu S_t \, dt + \sigma S_t \, dW_t$, we have:
$(dS_t)^2 = (\mu S_t \, dt + \sigma S_t \, dW_t)^2 = \sigma^2 S_t^2 (dW_t)^2 = \sigma^2 S_t^2 dt$

where we used the fact that $(dW_t)^2 = dt$, $dt \cdot dW_t = 0$, and
$(dt)^2 = 0$.

Applying Itô's lemma: \begin{align}
dV &= \frac{\partial V}{\partial t} dt + \frac{\partial V}{\partial S} dS_t + \frac{1}{2}\frac{\partial^2 V}{\partial S^2} (dS_t)^2 \\
&= \frac{\partial V}{\partial t} dt + \frac{\partial V}{\partial S} (\mu S_t \, dt + \sigma S_t \, dW_t) + \frac{1}{2}\frac{\partial^2 V}{\partial S^2} \sigma^2 S_t^2 dt \\
&= \left[\frac{\partial V}{\partial t} + \mu S_t \frac{\partial V}{\partial S} + \frac{1}{2}\sigma^2 S_t^2 \frac{\partial^2 V}{\partial S^2}\right] dt + \sigma S_t \frac{\partial V}{\partial S} dW_t
\end{align}
:::

### Step 3: Portfolio Dynamics

::: {.callout-important icon="false"}
### Lemma 4.2 (Portfolio Value Dynamics)

The change in portfolio value is: \begin{align}
d\Pi_t &= dV - \Delta_t dS_t \\
&= \left[\frac{\partial V}{\partial t} + \mu S_t \left(\frac{\partial V}{\partial S} - \Delta_t\right) + \frac{1}{2}\sigma^2 S_t^2 \frac{\partial^2 V}{\partial S^2}\right] dt \\
&\quad + \sigma S_t \left(\frac{\partial V}{\partial S} - \Delta_t\right) dW_t
\end{align}
:::

::: {.callout-note collapse="true"}
### Proof of Lemma 4.2

We have: \begin{align}
d\Pi_t &= dV - \Delta_t dS_t \\
&= \left[\frac{\partial V}{\partial t} + \mu S_t \frac{\partial V}{\partial S} + \frac{1}{2}\sigma^2 S_t^2 \frac{\partial^2 V}{\partial S^2}\right] dt + \sigma S_t \frac{\partial V}{\partial S} dW_t \\
&\quad - \Delta_t (\mu S_t dt + \sigma S_t dW_t) \\
&= \left[\frac{\partial V}{\partial t} + \mu S_t \frac{\partial V}{\partial S} + \frac{1}{2}\sigma^2 S_t^2 \frac{\partial^2 V}{\partial S^2} - \Delta_t \mu S_t\right] dt \\
&\quad + \sigma S_t \left(\frac{\partial V}{\partial S} - \Delta_t\right) dW_t \\
&= \left[\frac{\partial V}{\partial t} + \mu S_t \left(\frac{\partial V}{\partial S} - \Delta_t\right) + \frac{1}{2}\sigma^2 S_t^2 \frac{\partial^2 V}{\partial S^2}\right] dt \\
&\quad + \sigma S_t \left(\frac{\partial V}{\partial S} - \Delta_t\right) dW_t
\end{align}
:::

### Step 4: Eliminating Risk

::: {.callout-note icon="false"}
### Definition 4.3 (Delta-Neutral Portfolio)

To eliminate the stochastic component, we choose:
$\Delta_t = \frac{\partial V}{\partial S}$

This choice makes the portfolio instantaneously risk-free.
:::

::: {.callout-important icon="false"}
### Lemma 4.3 (Risk-Free Portfolio Dynamics)

With $\Delta_t = \frac{\partial V}{\partial S}$, the portfolio dynamics
become:
$d\Pi_t = \left[\frac{\partial V}{\partial t} + \frac{1}{2}\sigma^2 S_t^2 \frac{\partial^2 V}{\partial S^2}\right] dt$
:::

### Step 5: No-Arbitrage Condition

::: {.callout-important icon="false"}
### Theorem 4.1 (Risk-Free Rate Condition)

Since the portfolio is risk-free, it must earn the risk-free rate to
prevent arbitrage: $d\Pi_t = r\Pi_t dt$

Substituting
$\Pi_t = V - \Delta_t S_t = V - \frac{\partial V}{\partial S} S_t$:
$d\Pi_t = r\left(V - \frac{\partial V}{\partial S} S_t\right) dt$
:::

::: {.callout-note collapse="true"}
### Proof of Theorem 4.1

If a risk-free portfolio earned more than the risk-free rate, we could
borrow at rate $r$, invest in the portfolio, and earn a risk-free profit
(arbitrage). If it earned less, we could short the portfolio, lend at
rate $r$, and again earn risk-free profit.
:::

### Step 6: Deriving the Black-Scholes PDE

::: {.callout-important icon="false"}
### Theorem 4.2 (Black-Scholes Partial Differential Equation)

The option price $V(t,S)$ satisfies the Black-Scholes PDE:
$\frac{\partial V}{\partial t} + rS \frac{\partial V}{\partial S} + \frac{1}{2}\sigma^2 S^2 \frac{\partial^2 V}{\partial S^2} - rV = 0$

with terminal condition: $V(T,S) = (S-K)^+$
:::

::: {.callout-note collapse="true"}
### Proof of Theorem 4.2

Equating the two expressions for $d\Pi_t$:
$\frac{\partial V}{\partial t} + \frac{1}{2}\sigma^2 S_t^2 \frac{\partial^2 V}{\partial S^2} = r\left(V - \frac{\partial V}{\partial S} S_t\right)$

Rearranging:
$\frac{\partial V}{\partial t} + \frac{1}{2}\sigma^2 S_t^2 \frac{\partial^2 V}{\partial S^2} = rV - rS_t \frac{\partial V}{\partial S}$

Therefore:
$\frac{\partial V}{\partial t} + rS_t \frac{\partial V}{\partial S} + \frac{1}{2}\sigma^2 S_t^2 \frac{\partial^2 V}{\partial S^2} - rV = 0$

The terminal condition comes from the option payoff at maturity.
:::

### Step 7: Solving the PDE

To solve this PDE, we use a change of variables to transform it into the
heat equation.

::: {.callout-note icon="false"}
### Definition 4.4 (Variable Transformation)

Let: \begin{align}
\tau &= T - t \quad \text{(time to maturity)} \\
x &= \ln(S/K) \quad \text{(log-moneyness)} \\
u(\tau, x) &= e^{r\tau} \frac{V(T-\tau, Ke^x)}{K}
\end{align}
:::

::: {.callout-important icon="false"}
### Lemma 4.4 (Transformed PDE)

The function $u(\tau, x)$ satisfies the diffusion equation:
$\frac{\partial u}{\partial \tau} = \frac{1}{2}\sigma^2 \frac{\partial^2 u}{\partial x^2} + \left(r - \frac{\sigma^2}{2}\right) \frac{\partial u}{\partial x}$

with initial condition: $u(0, x) = (e^x - 1)^+$
:::

::: {.callout-note collapse="true"}
### Proof of Lemma 4.4

We need to compute the partial derivatives of $V$ in terms of $u$. We
have: $V(t,S) = K e^{-r(T-t)} u(T-t, \ln(S/K))$

Let $\tau = T-t$ and $x = \ln(S/K)$. Then:

```{=tex}
\begin{align}
\frac{\partial V}{\partial t} &= K e^{-r\tau} \left[r u - \frac{\partial u}{\partial \tau}\right] \\
\frac{\partial V}{\partial S} &= K e^{-r\tau} \frac{1}{S} \frac{\partial u}{\partial x} \\
\frac{\partial^2 V}{\partial S^2} &= K e^{-r\tau} \frac{1}{S^2} \left[\frac{\partial^2 u}{\partial x^2} - \frac{\partial u}{\partial x}\right]
\end{align}
```
Substituting into the Black-Scholes PDE and simplifying (after dividing
by $K e^{-r\tau}$):
$-\frac{\partial u}{\partial \tau} + \left(r - \frac{\sigma^2}{2}\right) \frac{\partial u}{\partial x} + \frac{1}{2}\sigma^2 \frac{\partial^2 u}{\partial x^2} = 0$

Therefore:
$\frac{\partial u}{\partial \tau} = \frac{1}{2}\sigma^2 \frac{\partial^2 u}{\partial x^2} + \left(r - \frac{\sigma^2}{2}\right) \frac{\partial u}{\partial x}$

The initial condition at $\tau = 0$ (i.e., $t = T$) is:
$u(0, x) = \frac{(Ke^x - K)^+}{K} = (e^x - 1)^+$
:::

::: {.callout-important icon="false"}
### Theorem 4.3 (Solution via Fundamental Solution)

The solution to the transformed PDE is:
$u(\tau, x) = \int_{-\infty}^{\infty} (e^y - 1)^+ G(\tau; x, y) dy$

where $G(\tau; x, y)$ is the fundamental solution:
$G(\tau; x, y) = \frac{1}{\sqrt{2\pi\sigma^2\tau}} \exp\left(-\frac{(y - x - (r-\sigma^2/2)\tau)^2}{2\sigma^2\tau}\right)$
:::

### Step 8: Computing the Solution

::: {.callout-important icon="false"}
### Theorem 4.4 (Explicit Solution of the PDE)

After computing the integral (which follows the same steps as in the
martingale approach), we obtain:
$u(\tau, x) = e^x \Phi(d_1) - \Phi(d_2)$

where: \begin{align}
d_1 &= \frac{x + (r + \sigma^2/2)\tau}{\sigma\sqrt{\tau}} \\
d_2 &= \frac{x + (r - \sigma^2/2)\tau}{\sigma\sqrt{\tau}} = d_1 - \sigma\sqrt{\tau}
\end{align}
:::

::: {.callout-important icon="false"}
### Theorem 4.5 (Black-Scholes Formula via PDE Method)

Transforming back to the original variables, the European call option
price is: $V(t,S) = S \Phi(d_1) - K e^{-r(T-t)} \Phi(d_2)$

where: \begin{align}
d_1 &= \frac{\ln(S/K) + (r + \sigma^2/2)(T-t)}{\sigma\sqrt{T-t}} \\
d_2 &= d_1 - \sigma\sqrt{T-t}
\end{align}
:::

::: {.callout-note collapse="true"}
### Proof of Theorem 4.5

We have: $V(t,S) = K e^{-r(T-t)} u(T-t, \ln(S/K))$

The transformation from the $u$ solution to the $V$ solution follows the
same integration techniques as in the martingale approach. The key
insight is that both methods yield identical results, demonstrating the
equivalence of risk-neutral valuation and PDE approaches.
:::

## Verification and Conclusion

::: {.callout-important icon="false"}
### Theorem 5.1 (Equivalence of Both Methods)

Both the martingale approach and the PDE approach yield the identical
Black-Scholes formula: $V(t,S) = S \Phi(d_1) - K e^{-r(T-t)} \Phi(d_2)$

This demonstrates the deep connection between:

-   Risk-neutral valuation (martingale theory)
-   Dynamic hedging and partial differential equations\
-   Stochastic calculus and deterministic analysis
:::

### Economic Interpretation

::: {.callout-tip icon="false"}
### Remark 5.1 (Economic Interpretation)

The Black-Scholes formula has a clear economic interpretation:

-   $S \Phi(d_1)$: Expected value of the stock if exercised, weighted by
    probability of exercise
-   $K e^{-r(T-t)} \Phi(d_2)$: Present value of strike price, weighted
    by probability of exercise\
-   $\Phi(d_2)$: Risk-neutral probability that option finishes
    in-the-money
-   $\Delta = \frac{\partial V}{\partial S} = \Phi(d_1)$: Hedge ratio
    (number of shares to hold per option)
:::

### Key Insights

::: {.callout-tip icon="false"}
### Remark 5.2 (Key Insights)

The derivation reveals several fundamental insights:

1.  The option price depends only on the risk-free rate $r$, not the
    actual expected return $\mu$ of the stock
2.  Perfect hedging is possible in continuous time with continuous
    trading
3.  The same formula emerges from completely different mathematical
    approaches
4.  The risk-neutral measure transforms the pricing problem into an
    expectation calculation
:::

### Greeks and Risk Management

::: {.callout-note icon="false"}
### Definition 5.1 (The Greeks)

The **Greeks** measure sensitivities of the option price to various
parameters:

**Delta**: $\Delta = \frac{\partial V}{\partial S} = \Phi(d_1)$ -
Measures sensitivity to stock price changes - Represents the hedge ratio

**Gamma**:
$\Gamma = \frac{\partial^2 V}{\partial S^2} = \frac{\phi(d_1)}{S\sigma\sqrt{T-t}}$ -
Measures rate of change of delta - Important for portfolio convexity

**Theta**:
$\Theta = \frac{\partial V}{\partial t} = -\frac{S\phi(d_1)\sigma}{2\sqrt{T-t}} - rKe^{-r(T-t)}\Phi(d_2)$ -
Measures time decay - Always negative for long call options

**Vega**:
$\nu = \frac{\partial V}{\partial \sigma} = S\phi(d_1)\sqrt{T-t}$ -
Measures sensitivity to volatility changes - Always positive for long
options

**Rho**:
$\rho = \frac{\partial V}{\partial r} = K(T-t)e^{-r(T-t)}\Phi(d_2)$ -
Measures sensitivity to interest rate changes

where $\phi(x) = \frac{1}{\sqrt{2\pi}}e^{-x^2/2}$ is the standard normal
density.
:::

### Extensions and Limitations

::: {.callout-warning icon="false"}
### Remark 5.3 (Model Assumptions and Limitations)

The Black-Scholes model relies on several strong assumptions:

**Assumptions:** - Constant risk-free rate and volatility - No
dividends - European exercise only - No transaction costs - Continuous
trading possible - Log-normal stock price distribution

**Limitations:** - Volatility smile/skew not captured - Jump risk
ignored - Early exercise features not handled - Transaction costs can be
significant - Liquidity constraints in practice

**Extensions:** - American options (early exercise) - Stochastic
volatility models (Heston, etc.) - Jump-diffusion models (Merton) -
Dividend-paying stocks - Time-dependent parameters
:::

### Computational Implementation

::: {.callout-note icon="false"}
### Example 5.1 (Python Implementation)

``` python
import numpy as np
from scipy.stats import norm

def black_scholes_call(S, K, T, r, sigma):
    """
    Calculate Black-Scholes call option price
    
    Parameters:
    S: Current stock price
    K: Strike price  
    T: Time to expiration
    r: Risk-free rate
    sigma: Volatility
    """
    d1 = (np.log(S/K) + (r + 0.5*sigma**2)*T) / (sigma*np.sqrt(T))
    d2 = d1 - sigma*np.sqrt(T)
    
    call_price = S*norm.cdf(d1) - K*np.exp(-r*T)*norm.cdf(d2)
    
    return call_price

def calculate_greeks(S, K, T, r, sigma):
    """Calculate the Greeks"""
    d1 = (np.log(S/K) + (r + 0.5*sigma**2)*T) / (sigma*np.sqrt(T))
    d2 = d1 - sigma*np.sqrt(T)
    
    delta = norm.cdf(d1)
    gamma = norm.pdf(d1) / (S*sigma*np.sqrt(T))
    theta = (-S*norm.pdf(d1)*sigma/(2*np.sqrt(T)) 
             - r*K*np.exp(-r*T)*norm.cdf(d2))
    vega = S*norm.pdf(d1)*np.sqrt(T)
    rho = K*T*np.exp(-r*T)*norm.cdf(d2)
    
    return {'delta': delta, 'gamma': gamma, 'theta': theta, 'vega': vega, 'rho': rho}

## Example usage
S0 = 100    ## Current stock price
K = 105     ## Strike price
T = 0.25    ## 3 months to expiration
r = 0.05    ## 5% risk-free rate  
sigma = 0.2 ## 20% volatility

price = black_scholes_call(S0, K, T, r, sigma)
greeks = calculate_greeks(S0, K, T, r, sigma)

print(f"Call option price: ${price:.2f}")
print(f"Delta: {greeks['delta']:.4f}")
print(f"Gamma: {greeks['gamma']:.4f}")
```
:::

This complete treatment of the Black-Scholes model provides both
theoretical rigor and practical applicability, showing how mathematical
finance bridges pure mathematics and real-world financial applications.

## Introduction

The Feynman-Kac theorem provides a fundamental connection between
partial differential equations and stochastic processes. While our
previous Black-Scholes derivations used either pure martingale methods
or pure PDE methods, the Feynman-Kac theorem elegantly unifies both
approaches and provides the most direct path from the Black-Scholes PDE
to the risk-neutral valuation formula.

::: callout-tip
### Why Feynman-Kac Matters

The Feynman-Kac theorem shows that the solution to certain PDEs can be
represented as expectations of stochastic processes. This is exactly
what we need in finance: we derive a PDE from no-arbitrage arguments,
then use Feynman-Kac to get the risk-neutral pricing formula.
:::

## Part I: The Feynman-Kac Theorem

### Statement of the Theorem

::: {.callout-important icon="false"}
### Theorem 1.1 (Feynman-Kac Theorem)

Consider the parabolic PDE:
$$\frac{\partial u}{\partial t} + \frac{1}{2}\sigma^2(t,x) \frac{\partial^2 u}{\partial x^2} + b(t,x) \frac{\partial u}{\partial x} - r(t,x) u + f(t,x) = 0$$

for $(t,x) \in [0,T) \times \mathbb{R}$, with terminal condition:
$$u(T,x) = g(x)$$

**Assumptions:** 1. $\sigma(t,x) > 0$ (non-degeneracy) 2. $b(t,x)$,
$\sigma(t,x)$, $r(t,x)$, $f(t,x)$ satisfy appropriate regularity
conditions 3. The associated SDE has a unique strong solution 4.
Polynomial growth conditions on coefficients

Then the solution is given by:
$$u(t,x) = \mathbb{E}\left[ e^{-\int_t^T r(s,X_s) ds} g(X_T) + \int_t^T e^{-\int_t^s r(u,X_u) du} f(s,X_s) ds \,\Big|\, X_t = x \right]$$

where $X_s$ is the solution to the SDE:
$$dX_s = b(s,X_s) ds + \sigma(s,X_s) dW_s, \quad X_t = x$$
:::

::: {.callout-note collapse="true"}
### Complete Proof of Feynman-Kac Theorem

The proof uses Itô's lemma and the martingale representation theorem.

**Step 1: Define the discounted process** Let
$Y_s = e^{-\int_t^s r(u,X_u) du} u(s,X_s)$ for $s \in [t,T]$.

**Step 2: Apply Itô's lemma to** $Y_s$ We need to compute $dY_s$. Using
the product rule and Itô's lemma:

```{=tex}
\begin{align}
dY_s &= d\left(e^{-\int_t^s r(u,X_u) du}\right) u(s,X_s) + e^{-\int_t^s r(u,X_u) du} du(s,X_s) \\
&\quad + d\left(e^{-\int_t^s r(u,X_u) du}\right) du(s,X_s)
\end{align}
```
**Step 3: Compute each term**

For the discount factor:
$$d\left(e^{-\int_t^s r(u,X_u) du}\right) = -r(s,X_s) e^{-\int_t^s r(u,X_u) du} ds$$

For $u(s,X_s)$, by Itô's lemma: \begin{align}
du(s,X_s) &= \frac{\partial u}{\partial s} ds + \frac{\partial u}{\partial x} dX_s + \frac{1}{2}\frac{\partial^2 u}{\partial x^2} (dX_s)^2 \\
&= \left[\frac{\partial u}{\partial s} + b(s,X_s)\frac{\partial u}{\partial x} + \frac{1}{2}\sigma^2(s,X_s)\frac{\partial^2 u}{\partial x^2}\right] ds \\
&\quad + \sigma(s,X_s)\frac{\partial u}{\partial x} dW_s
\end{align}

**Step 4: Substitute the PDE** From our PDE, we know:
$$\frac{\partial u}{\partial s} + b(s,X_s)\frac{\partial u}{\partial x} + \frac{1}{2}\sigma^2(s,X_s)\frac{\partial^2 u}{\partial x^2} = r(s,X_s)u - f(s,X_s)$$

**Step 5: Combine terms** \begin{align}
dY_s &= e^{-\int_t^s r(u,X_u) du} \left[-r(s,X_s)u(s,X_s) + r(s,X_s)u(s,X_s) - f(s,X_s)\right] ds \\
&\quad + e^{-\int_t^s r(u,X_u) du} \sigma(s,X_s)\frac{\partial u}{\partial x} dW_s \\
&= -e^{-\int_t^s r(u,X_u) du} f(s,X_s) ds + e^{-\int_t^s r(u,X_u) du} \sigma(s,X_s)\frac{\partial u}{\partial x} dW_s
\end{align}

**Step 6: Integrate from** $t$ to $T$
$$Y_T - Y_t = -\int_t^T e^{-\int_t^s r(u,X_u) du} f(s,X_s) ds + \int_t^T e^{-\int_t^s r(u,X_u) du} \sigma(s,X_s)\frac{\partial u}{\partial x} dW_s$$

**Step 7: Take expectation** The stochastic integral has zero
expectation (under appropriate integrability conditions):
$$\mathbb{E}[Y_T | X_t = x] = Y_t - \mathbb{E}\left[\int_t^T e^{-\int_t^s r(u,X_u) du} f(s,X_s) ds \,\Big|\, X_t = x\right]$$

**Step 8: Substitute definitions** \begin{align}
\mathbb{E}\left[e^{-\int_t^T r(u,X_u) du} u(T,X_T) \,\Big|\, X_t = x\right] &= u(t,x) \\
&\quad - \mathbb{E}\left[\int_t^T e^{-\int_t^s r(u,X_u) du} f(s,X_s) ds \,\Big|\, X_t = x\right]
\end{align}

**Step 9: Use terminal condition** $u(T,x) = g(x)$
$$u(t,x) = \mathbb{E}\left[e^{-\int_t^T r(u,X_u) du} g(X_T) + \int_t^T e^{-\int_t^s r(u,X_u) du} f(s,X_s) ds \,\Big|\, X_t = x\right]$$

This completes the proof.
:::

### Key Insights of Feynman-Kac

::: callout-tip
### Remark 1.1 (PDE-SDE Duality)

The Feynman-Kac theorem reveals a fundamental duality:

**PDE Side**: Deterministic partial differential equation with boundary
conditions **SDE Side**: Stochastic differential equation with
expectation of terminal payoff

This duality is the mathematical foundation of: - Risk-neutral pricing
in finance - Monte Carlo methods for PDE solving - Connection between
heat equations and Brownian motion - Quantum mechanics (Feynman path
integrals)
:::

## Part II: Application to Black-Scholes

### Black-Scholes PDE Setup

::: {.callout-note icon="false"}
### Definition 2.1 (Black-Scholes PDE)

From our hedging argument, we derived that the option price $V(t,S)$
satisfies:
$$\frac{\partial V}{\partial t} + rS \frac{\partial V}{\partial S} + \frac{1}{2}\sigma^2 S^2 \frac{\partial^2 V}{\partial S^2} - rV = 0$$

with terminal condition:
$$V(T,S) = h(S) = (S-K)^+ \text{ for call options}$$

**Key Assumptions:** 1. Constant risk-free rate $r$ 2. Constant
volatility $\sigma$\
3. No dividends 4. Continuous trading possible 5. No transaction costs
6. European exercise only
:::

### Transforming to Standard Feynman-Kac Form

::: {.callout-note icon="false"}
### Definition 2.2 (Variable Transformation)

To apply Feynman-Kac, we make the substitution $x = \ln S$ to transform
the PDE.

Let $u(t,x) = V(t,e^x)$. Then: - $S = e^x$ -
$\frac{\partial V}{\partial S} = \frac{1}{S}\frac{\partial u}{\partial x} = e^{-x}\frac{\partial u}{\partial x}$ -
$\frac{\partial^2 V}{\partial S^2} = e^{-2x}\left(\frac{\partial^2 u}{\partial x^2} - \frac{\partial u}{\partial x}\right)$ -
$\frac{\partial V}{\partial t} = \frac{\partial u}{\partial t}$
:::

::: {.callout-note collapse="true"}
### Detailed Variable Transformation

**Step 1**: Express derivatives in terms of $u(t,x)$.

Since $V(t,S) = u(t,\ln S)$, by the chain rule:
$$\frac{\partial V}{\partial S} = \frac{\partial u}{\partial x} \frac{\partial x}{\partial S} = \frac{\partial u}{\partial x} \frac{1}{S}$$

For the second derivative: \begin{align}
\frac{\partial^2 V}{\partial S^2} &= \frac{\partial}{\partial S}\left(\frac{1}{S}\frac{\partial u}{\partial x}\right) \\
&= -\frac{1}{S^2}\frac{\partial u}{\partial x} + \frac{1}{S}\frac{\partial}{\partial S}\left(\frac{\partial u}{\partial x}\right) \\
&= -\frac{1}{S^2}\frac{\partial u}{\partial x} + \frac{1}{S}\frac{\partial^2 u}{\partial x^2}\frac{\partial x}{\partial S} \\
&= -\frac{1}{S^2}\frac{\partial u}{\partial x} + \frac{1}{S^2}\frac{\partial^2 u}{\partial x^2} \\
&= \frac{1}{S^2}\left(\frac{\partial^2 u}{\partial x^2} - \frac{\partial u}{\partial x}\right)
\end{align}

**Step 2**: Substitute into the Black-Scholes PDE. \begin{align}
&\frac{\partial u}{\partial t} + rS \cdot \frac{1}{S}\frac{\partial u}{\partial x} + \frac{1}{2}\sigma^2 S^2 \cdot \frac{1}{S^2}\left(\frac{\partial^2 u}{\partial x^2} - \frac{\partial u}{\partial x}\right) - ru = 0 \\
&\frac{\partial u}{\partial t} + r\frac{\partial u}{\partial x} + \frac{1}{2}\sigma^2\left(\frac{\partial^2 u}{\partial x^2} - \frac{\partial u}{\partial x}\right) - ru = 0 \\
&\frac{\partial u}{\partial t} + \left(r - \frac{\sigma^2}{2}\right)\frac{\partial u}{\partial x} + \frac{1}{2}\sigma^2\frac{\partial^2 u}{\partial x^2} - ru = 0
\end{align}

**Step 3**: Rearrange to standard form.
$$\frac{\partial u}{\partial t} + \frac{1}{2}\sigma^2\frac{\partial^2 u}{\partial x^2} + \left(r - \frac{\sigma^2}{2}\right)\frac{\partial u}{\partial x} - ru = 0$$

This is now in the standard Feynman-Kac form with: -
$b(t,x) = r - \frac{\sigma^2}{2}$ (drift coefficient) -
$\sigma(t,x) = \sigma$ (diffusion coefficient)\
- $r(t,x) = r$ (discount rate) - $f(t,x) = 0$ (source term)
:::

### Applying Feynman-Kac to Black-Scholes

::: {.callout-important icon="false"}
### Theorem 2.1 (Black-Scholes via Feynman-Kac)

The transformed Black-Scholes PDE:
$$\frac{\partial u}{\partial t} + \frac{1}{2}\sigma^2\frac{\partial^2 u}{\partial x^2} + \left(r - \frac{\sigma^2}{2}\right)\frac{\partial u}{\partial x} - ru = 0$$

with terminal condition $u(T,x) = h(e^x) = (e^x - K)^+$, has the
solution: $$u(t,x) = e^{-r(T-t)} \mathbb{E}[h(e^{X_T}) | X_t = x]$$

where $X_s$ satisfies the SDE:
$$dX_s = \left(r - \frac{\sigma^2}{2}\right) ds + \sigma dW_s, \quad X_t = x$$

**Therefore, the Black-Scholes option price is:**
$$V(t,S) = u(t,\ln S) = e^{-r(T-t)} \mathbb{E}[h(S_T) | S_t = S]$$

where
$S_T = S_t \exp\left(\left(r - \frac{\sigma^2}{2}\right)(T-t) + \sigma(W_T - W_t)\right)$.
:::

::: {.callout-note collapse="true"}
### Detailed Application of Feynman-Kac

**Step 1**: Identify the parameters for Feynman-Kac. From our
transformed PDE: - $b(t,x) = r - \frac{\sigma^2}{2}$ -
$\sigma(t,x) = \sigma$\
- $r(t,x) = r$ - $f(t,x) = 0$ - $g(x) = (e^x - K)^+$

**Step 2**: Write the associated SDE.
$$dX_s = \left(r - \frac{\sigma^2}{2}\right) ds + \sigma dW_s$$

**Step 3**: Apply the Feynman-Kac formula. Since $f(t,x) = 0$, the
formula simplifies to:
$$u(t,x) = \mathbb{E}\left[e^{-r(T-t)} g(X_T) \,\Big|\, X_t = x\right]$$

**Step 4**: Solve the SDE. The solution to the linear SDE is:
$$X_T = X_t + \left(r - \frac{\sigma^2}{2}\right)(T-t) + \sigma(W_T - W_t)$$

**Step 5**: Transform back to stock price. Since $X = \ln S$, we have:
\begin{align}
\ln S_T &= \ln S_t + \left(r - \frac{\sigma^2}{2}\right)(T-t) + \sigma(W_T - W_t) \\
S_T &= S_t \exp\left(\left(r - \frac{\sigma^2}{2}\right)(T-t) + \sigma(W_T - W_t)\right)
\end{align}

**Step 6**: Final formula.
$$V(t,S_t) = e^{-r(T-t)} \mathbb{E}[(S_T - K)^+ | S_t]$$

This is exactly the risk-neutral valuation formula!
:::

### The Key Insight: Automatic Risk-Neutral Measure

::: callout-tip
### Remark 2.1 (Feynman-Kac Reveals the Risk-Neutral Measure)

The beauty of the Feynman-Kac approach is that it **automatically
produces the risk-neutral measure** without explicitly constructing it
via Girsanov's theorem.

**What happens:** 1. We start with the Black-Scholes PDE (derived from
no-arbitrage hedging) 2. Feynman-Kac gives us the stochastic
representation 3. The resulting SDE for $X_t = \ln S_t$ has drift
$r - \sigma^2/2$ 4. This corresponds to the stock having drift $r$ under
the measure induced by the Feynman-Kac expectation 5. This measure is
exactly the risk-neutral measure $\mathbb{Q}$!

**The connection:** - PDE approach: Hedging → Black-Scholes PDE →
Feynman-Kac → Risk-neutral expectation - Martingale approach:
No-arbitrage → Risk-neutral measure → Expectation formula

Both paths lead to the same destination, but Feynman-Kac provides the
bridge.
:::

## Part III: Complete Assumptions and Regularity Conditions

### Mathematical Assumptions for Feynman-Kac

::: {.callout-warning icon="false"}
### Assumption 3.1 (Regularity Conditions for Feynman-Kac)

For the Feynman-Kac theorem to apply to the Black-Scholes PDE, we need:

**Coefficient Regularity:** 1. $b(t,x) = r - \sigma^2/2$ is constant
(trivially satisfies Lipschitz and linear growth) 2.
$\sigma(t,x) = \sigma > 0$ is constant and positive (non-degeneracy) 3.
$r(t,x) = r \geq 0$ is constant (ensures well-defined discounting)

**Domain and Boundary Conditions:** 4. Domain:
$(t,x) \in [0,T) \times \mathbb{R}$ (unbounded spatial domain) 5.
Terminal condition: $u(T,x) = (e^x - K)^+$ has polynomial growth 6. No
spatial boundary conditions needed (due to infinite domain)

**Solution Existence and Uniqueness:** 7. The associated SDE
$dX_s = (r-\sigma^2/2)ds + \sigma dW_s$ has unique strong solution 8.
The solution has finite moments of all orders 9. The PDE has a unique
classical solution in the class of functions with polynomial growth
:::

::: {.callout-note collapse="true"}
### Verification of Black-Scholes Assumptions

**Assumption 1-3 (Coefficient Properties)**: ✓ All coefficients are
constants, so they trivially satisfy: - Lipschitz continuity:
$|b(t,x) - b(t,y)| \leq L|x-y|$ (with $L=0$) - Linear growth:
$|b(t,x)| \leq C(1+|x|)$ (with $C = |r-\sigma^2/2|$) - Non-degeneracy:
$\sigma > 0$

**Assumption 4 (Domain)**: ✓ The log-price $x = \ln S$ can take any real
value, making $\mathbb{R}$ the natural domain.

**Assumption 5 (Terminal Condition)**: ✓ $(e^x - K)^+ \leq e^{|x|} + K$
has exponential growth, which satisfies polynomial growth conditions for
the theorem.

**Assumption 7 (SDE Solution)**: ✓ The SDE $dX_s = \mu ds + \sigma dW_s$
with constant coefficients has the explicit solution:
$$X_t = X_0 + \mu t + \sigma W_t$$ This clearly has a unique strong
solution.

**Assumption 8 (Finite Moments)**: ✓ Since $X_t$ is Gaussian, it has
finite moments of all orders.

**Assumption 9 (PDE Solution)**: ✓ The Black-Scholes PDE is a
well-studied parabolic PDE with known classical solutions.
:::

### Financial Market Assumptions

::: {.callout-warning icon="false"}
### Assumption 3.2 (Black-Scholes Market Assumptions)

The financial market model requires:

**Asset Price Dynamics:** 1. Stock follows geometric Brownian motion:
$dS_t = \mu S_t dt + \sigma S_t dW_t$ 2. Constant risk-free rate $r > 0$
3. Constant volatility $\sigma > 0$ 4. No dividends paid during option
life 5. Stock price always positive: $S_t > 0$

**Market Structure:** 6. Frictionless market (no transaction costs,
bid-ask spreads) 7. Continuous trading possible at all times 8.
Unlimited borrowing and lending at rate $r$ 9. Short-selling allowed
with full proceeds available 10. No restrictions on position sizes

**Information and Arbitrage:** 11. All market participants have same
information (complete information) 12. No arbitrage opportunities exist
13. Market is complete (all contingent claims can be replicated) 14.
Risk-free asset and risky stock span the entire market

**Option Characteristics:** 15. European exercise only (no early
exercise) 16. Strike price $K > 0$ fixed 17. Maturity $T > 0$ fixed 18.
Option payoff $(S_T - K)^+$ depends only on terminal stock price
:::

### Comparison with Alternative Approaches

::: callout-tip
### Remark 3.1 (Strengths and Weaknesses of Different Approaches)

**Martingale Approach:** - **Strengths**: Direct probabilistic
interpretation, connects to fundamental theorems - **Weaknesses**:
Requires explicit construction of risk-neutral measure via Girsanov

**PDE Approach:**\
- **Strengths**: Uses familiar hedging intuition, connects to numerical
methods - **Weaknesses**: Requires solving PDE, less direct connection
to probability

**Feynman-Kac Approach:** - **Strengths**: Unifies PDE and probability,
automatic risk-neutral measure, generalizes easily - **Weaknesses**:
Requires understanding of both PDE and SDE theory, more abstract

**When to Use Each:** - **Martingale**: When risk-neutral measure is
natural starting point - **PDE**: When hedging interpretation is most
important\
- **Feynman-Kac**: When connecting different mathematical frameworks or
generalizing to complex payoffs
:::

## Part IV: Extensions and Applications

### Generalizations of Feynman-Kac in Finance

::: {.callout-note icon="false"}
### Example 4.1 (American Options via Optimal Stopping)

For American options, Feynman-Kac extends to optimal stopping problems:

$$V(t,S) = \sup_{\tau \geq t} \mathbb{E}\left[e^{-r(\tau-t)} h(S_\tau) \,\Big|\, S_t = S\right]$$

where the supremum is over all stopping times $\tau \in [t,T]$.

This leads to free boundary problems and variational inequalities.
:::

::: {.callout-note icon="false"}
### Example 4.2 (Path-Dependent Options)

For Asian options with payoff depending on $\int_0^T S_u du$, we extend
the state space:

Let $Y_t = \int_0^t S_u du$. Then $(S_t, Y_t)$ follows a 2D system:
\begin{align}
dS_t &= rS_t dt + \sigma S_t dW_t \\
dY_t &= S_t dt
\end{align}

Feynman-Kac applies to the corresponding 2D PDE.
:::

::: {.callout-note icon="false"}
### Example 4.3 (Jump-Diffusion Models)

For jump-diffusion processes:
$$dS_t = \mu S_t dt + \sigma S_t dW_t + S_{t-} \int h(z) \tilde{N}(dt,dz)$$

The Feynman-Kac theorem extends to integro-differential equations
(PIDEs).
:::

### Computational Advantages

::: callout-tip
### Remark 4.1 (Monte Carlo and PDE Methods)

The Feynman-Kac representation enables two complementary numerical
approaches:

**Monte Carlo Simulation:** - Simulate the SDE paths - Compute sample
average of discounted payoffs - Converges by Law of Large Numbers

**PDE Finite Differences:** - Discretize the PDE on a grid - Solve
numerically using implicit/explicit schemes - Converges to PDE solution

Both methods solve the same problem via Feynman-Kac duality!
:::

## Conclusion

::: {.callout-important icon="false"}
### Theorem 4.1 (Unified Black-Scholes Result)

The Black-Scholes option pricing formula:
$$V(t,S) = S\Phi(d_1) - Ke^{-r(T-t)}\Phi(d_2)$$

can be derived through three equivalent approaches:

1.  **Martingale**: Risk-neutral measure → Expectation calculation
2.  **PDE**: Hedging portfolio → Black-Scholes PDE → Analytical
    solution\
3.  **Feynman-Kac**: PDE → Stochastic representation → Risk-neutral
    expectation

All three methods yield identical results, demonstrating the deep
mathematical unity underlying modern quantitative finance.
:::

::: callout-tip
### Final Insights

**The Feynman-Kac approach reveals that:** - PDEs and stochastic
processes are dual representations of the same underlying mathematics -
The risk-neutral measure emerges naturally from the PDE structure -
Option pricing connects heat equations, Brownian motion, and financial
hedging - Monte Carlo and finite difference methods are fundamentally
solving the same problem

**This unity suggests that:** - Different mathematical tools often lead
to the same financial insights - The choice of method depends on
computational needs and theoretical focus - Understanding multiple
approaches deepens comprehension of the underlying economics

The Feynman-Kac theorem thus provides not just another derivation
method, but a unifying perspective that bridges deterministic and
stochastic approaches to mathematical finance.
:::

------------------------------------------------------------------------

*This derivation completes the trilogy of Black-Scholes approaches,
showing how partial differential equations, stochastic processes, and
martingale theory all contribute to our understanding of option
pricing.*
