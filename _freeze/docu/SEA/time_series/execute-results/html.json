{
  "hash": "b4213613b4de8237b12fb59154c44621",
  "result": {
    "markdown": "---\ntitle: \"Time Series Analysis\"\n\nexecute: \n  warning: false\n  freeze: true\n  cache: true\nformat:\n  html:\n    html-math-method: katex\n    code-block-bg: \"#E5E7E9\"\n    df-print: paged\n    code-overflow : wrap\n    code-copy : true\n---\n\n\n## Introduction\n\n### Resources\n\n-   Time series analysis by James D Hamilton - its considered to be the bible on time series analysis, pretty much covers all the theory , it doesnt have any code or pseudocode\n\n-   Introduction to Time Series with R by Metcalfe & Coweperwait\n\n-   Analysis of Financial Time Series by Tsay\n\n### Aim and Motivation\n\n-   Would be exploring time series analysis in the context of finance\n-   Implementing code from the book by Tsay , would be using the book by Hamilton and Metcalfe as reference\n-   Aim to understand different time series models in R.\n-   (Will keep on adding the aims as is go on)\n\n## Financial Time Series and Linear Time series\n\n### Asset Returns\n\n::: {#def-Simple_gross_return}\n## Simple gross return\n\n<br/> <u>Arithmetic Returns</u>\n\n$$P_t = P_{t-1}(1+R_t) \\implies R_t = \\frac{P_t - P_{t-1}}{P_t}$$ where $P_t$ and $R_t$ are the price and return at time $t$ respectively <br/> <u>Continuously compounded return or log return</u>\n\n$$r_t = \\ln(1+R_t)$$ <br/> <u>Dividend Payment</u>\n\n$$r_t = \\ln(P_t + D_t) -\\ln(P_{t-1})$$ Where $D_t$ is dividend payment between time t-1 and time t .\n:::\n\n<br/>\n\n::: {#def-Multiperiod_simple_return}\n## Multiperiod gross return\n\n<br/> Similiary we can define <u>multiperiod simple return</u> by $$ R_t[k] = exp{[\\frac{1}{k}\\sum_{j=0}^{k-1}(1+R_{t-j})]} -1$$ where exp is the exponentential function and k is total number periods the asset was held for.\n\n<u>Log return</u> would be $$ r_t[k] = r_t +r_{t-1}+.....+r_{t-k+1}$$\n:::\n\n::: {#def-Portfolio_return}\n## Portfolio Return\n\n$$R_{p,t}= \\sum_{i=1}^{N}w_i R_{it}$$\n\nWhere $p$ is the portfolio , $i$ the ith asset and $w_i$ the weight of the ith asset in the portofolio\n:::\n\n[\\* Load data and header =T give the 1st row of the data file , that is the names of the cloumns of the data set]{.aside}\n\n\n::: {.cell code-block-border-right='false' hash='time_series_cache/html/unnamed-chunk-1_7cb28d420f37712e532032884dcbd7fc'}\n\n```{.r .cell-code}\n# da contains the return for 5 five stocks and indexes namely IBM ,value-weighted , equal-weighted and S&P composite index from 1970 to 2008\nlibrary(fBasics)\nda = read.table(\"TST/d-ibm3dx7008.txt\",header = T) \ndim(da) # dimensions for the data\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 9845    5\n```\n:::\n\n```{.r .cell-code}\nda[1:5,]# first five rows\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"\"],\"name\":[\"_rn_\"],\"type\":[\"\"],\"align\":[\"left\"]},{\"label\":[\"Date\"],\"name\":[1],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"rtn\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"vwretd\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"ewretd\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"sprtrn\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"19700102\",\"2\":\"0.000686\",\"3\":\"0.012137\",\"4\":\"0.033450\",\"5\":\"0.010211\",\"_rn_\":\"1\"},{\"1\":\"19700105\",\"2\":\"0.009596\",\"3\":\"0.006375\",\"4\":\"0.018947\",\"5\":\"0.004946\",\"_rn_\":\"2\"},{\"1\":\"19700106\",\"2\":\"0.000679\",\"3\":\"-0.007233\",\"4\":\"-0.005776\",\"5\":\"-0.006848\",\"_rn_\":\"3\"},{\"1\":\"19700107\",\"2\":\"0.000678\",\"3\":\"-0.001272\",\"4\":\"0.003559\",\"5\":\"-0.002047\",\"_rn_\":\"4\"},{\"1\":\"19700108\",\"2\":\"0.002034\",\"3\":\"0.000564\",\"4\":\"0.002890\",\"5\":\"0.000540\",\"_rn_\":\"5\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\ntail(da)#Last 5 rows\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"\"],\"name\":[\"_rn_\"],\"type\":[\"\"],\"align\":[\"left\"]},{\"label\":[\"Date\"],\"name\":[1],\"type\":[\"int\"],\"align\":[\"right\"]},{\"label\":[\"rtn\"],\"name\":[2],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"vwretd\"],\"name\":[3],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"ewretd\"],\"name\":[4],\"type\":[\"dbl\"],\"align\":[\"right\"]},{\"label\":[\"sprtrn\"],\"name\":[5],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"20081223\",\"2\":\"-0.016953\",\"3\":\"-0.007618\",\"4\":\"-0.008332\",\"5\":\"-0.009717\",\"_rn_\":\"9840\"},{\"1\":\"20081224\",\"2\":\"-0.000993\",\"3\":\"0.004463\",\"4\":\"0.005254\",\"5\":\"0.005781\",\"_rn_\":\"9841\"},{\"1\":\"20081226\",\"2\":\"0.010060\",\"3\":\"0.007170\",\"4\":\"0.011629\",\"5\":\"0.005356\",\"_rn_\":\"9842\"},{\"1\":\"20081229\",\"2\":\"-0.000984\",\"3\":\"-0.004481\",\"4\":\"-0.016514\",\"5\":\"-0.003873\",\"_rn_\":\"9843\"},{\"1\":\"20081230\",\"2\":\"0.028308\",\"3\":\"0.024951\",\"4\":\"0.021692\",\"5\":\"0.024407\",\"_rn_\":\"9844\"},{\"1\":\"20081231\",\"2\":\"0.007301\",\"3\":\"0.017513\",\"4\":\"0.036731\",\"5\":\"0.014158\",\"_rn_\":\"9845\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\nibm = da[,2] # IBM simple returns\n\nsibm = ibm*100 #Percentage simple returns \n\nbasicStats(sibm)\n```\n\n::: {.cell-output-display}\n`````{=html}\n<div data-pagedtable=\"false\">\n  <script data-pagedtable-source type=\"application/json\">\n{\"columns\":[{\"label\":[\"\"],\"name\":[\"_rn_\"],\"type\":[\"\"],\"align\":[\"left\"]},{\"label\":[\"sibm\"],\"name\":[1],\"type\":[\"dbl\"],\"align\":[\"right\"]}],\"data\":[{\"1\":\"9845.000000\",\"_rn_\":\"nobs\"},{\"1\":\"0.000000\",\"_rn_\":\"NAs\"},{\"1\":\"-22.963000\",\"_rn_\":\"Minimum\"},{\"1\":\"13.163600\",\"_rn_\":\"Maximum\"},{\"1\":\"-0.857100\",\"_rn_\":\"1. Quartile\"},{\"1\":\"0.883300\",\"_rn_\":\"3. Quartile\"},{\"1\":\"0.040161\",\"_rn_\":\"Mean\"},{\"1\":\"0.000000\",\"_rn_\":\"Median\"},{\"1\":\"395.387600\",\"_rn_\":\"Sum\"},{\"1\":\"0.017058\",\"_rn_\":\"SE Mean\"},{\"1\":\"0.006724\",\"_rn_\":\"LCL Mean\"},{\"1\":\"0.073599\",\"_rn_\":\"UCL Mean\"},{\"1\":\"2.864705\",\"_rn_\":\"Variance\"},{\"1\":\"1.692544\",\"_rn_\":\"Stdev\"},{\"1\":\"0.061399\",\"_rn_\":\"Skewness\"},{\"1\":\"9.916359\",\"_rn_\":\"Kurtosis\"}],\"options\":{\"columns\":{\"min\":{},\"max\":[10]},\"rows\":{\"min\":[10],\"max\":[10]},\"pages\":{}}}\n  </script>\n</div>\n`````\n:::\n\n```{.r .cell-code}\ns1 = skewness(sibm)\nt = s1/sqrt(6/9845) #defintion for test statistic here 9845 is N \nt\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 2.487093\nattr(,\"method\")\n[1] \"moment\"\n```\n:::\n\n```{.r .cell-code}\npv  = 2*(1-pnorm(t)) # Calculate p-value\npv\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.01287919\nattr(,\"method\")\n[1] \"moment\"\n```\n:::\n:::\n\n::: {.cell layout-ncol=\"2\" hash='time_series_cache/html/unnamed-chunk-2_ccf419ebebd9b268c5b4336e35320b41'}\n\n```{.r .cell-code}\nlibrary(ggplot2)\nibm = as.data.frame(da[,1:2])\n\nibm[\"log_return\"] = log(1+ibm[\"rtn\"])\n\ncolnames(ibm)[2] <- \"simple_return\"\n\nggplot(ibm,aes(x = simple_return,colour =\"Emperical\"))+\nggtitle(\"Simple return distribution\") + \nxlim (-0.15,0.15)+\ngeom_density()+\nstat_function(mapping = aes(colour = \"Normal\"),\n              fun = dnorm,args = with(ibm,c(mean =mean(simple_return),\n             sd = sd(simple_return))))\n```\n\n::: {.cell-output-display}\n![](time_series_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n\n```{.r .cell-code}\nggplot(ibm,aes(x = log_return,colour = \"Emperical\"))+\nggtitle(\"Log return distribution\") + \nxlim (-0.15,0.15)+geom_density()+\nstat_function(mapping = aes(colour = \"Normal\"),\n             fun = dnorm,args = with(ibm,c(mean = mean(log_return),\n             sd = sd(log_return))))+ \nscale_x_continuous(\"log return distribution\",limits = c(-0.15,0.15))\n```\n\n::: {.cell-output-display}\n![](time_series_files/figure-html/unnamed-chunk-2-2.png){width=672}\n:::\n:::\n\n::: {.cell hash='time_series_cache/html/unnamed-chunk-3_609f41233a0b2e63b3978d989112ac2a'}\n\n```{.r .cell-code}\nIBM = ibm[, 2]\n\n\nIBM = ts(IBM,frequency = 250 ,start = c(1970,1))\n\nplot.ts(IBM)\n```\n\n::: {.cell-output-display}\n![](time_series_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n\n```{.r .cell-code}\nacf(IBM,lag=250,ylim= c(-0.05,0.05))#ACF is covered in detail down below , the x axis label is fraction of unit time \n```\n\n::: {.cell-output-display}\n![](time_series_files/figure-html/unnamed-chunk-3-2.png){width=672}\n:::\n:::\n\n\n### Linear Time Series\n\n<u> Stationarity</u>\n\nFoundation of time series analysis is Stationarity. A time series $\\{r_t\\}$ is said to be strictly stationary if the joint distribution of $(r_{t_{1}},r_{t_{2}},r_{t_{3}},....,r_{t_{k}})$ is identical to that of $(r_{t_{1+t}},r_{t_{2+t}},r_{t_{3+t}},....,r_{t_{k+t}})$ for all $t$ , where $k$ is an arbitrary positive integer and $(t_1,t_2,t_3,....,t_k)$ is collection of $k$ positive integers. Strict stationarity is very hard to verify emperically <br/> A time series is said to be weakly stationary if the mean of $r_t$ and the covariance between $r_t$ and $r_{t-l}$ are time invariant where $l$ is an arbitrary integer. Weak stationarity enables us to make inference concerning future observations\n\n-   $\\mathbb{E}(t_t) = \\mu$\n-   $Cov(r_t,t_{t-l}) = \\gamma_l$\n\nWeak stationarity is commonly studied and more practical.\n\nThe covariance $\\gamma_l = Cov(r_t,r_{t-l})$ is called the <u>lag-$l$ autocovariance of $r_t$</u>. From the above defintion it follows that\n\n-   $\\gamma_0=Var(r_t)$\n-   $\\gamma_{-l} = \\gamma_l$\n\n<u> Autocorrelation Function</u>\n\nConsider a weakly stationary return series $r_t$. When the linear dependence between $r_t$ and its past values $r_{t-l}$ is of interest , the concept of correlation is generalised to autocorrelation. The correlation coefficient between $r_t$ and $r_{t-l}$ is called the lag-l autocorrelation of $r_t$ and is commonly denoted by $\\rho_l$ , which under the weak stationarity assumption is a function of l only. Its defined by $$ \\rho_l = \\frac{Cov(r_t,r_{t-l})}{\\sqrt{Var(r_t)Var(r_{t-l})}} = \\frac{Cov(r_t,r_{t-l})}{Var(r_t)} = \\frac{\\gamma_l}{\\gamma_0}$$\n\nIts easy to see that\n\n-   $\\rho_0 = 1$\n-   $\\rho_l = \\rho_{-l}$\n-   $-1\\leq \\rho_l \\leq 1$\n\nFor a given sample of returns $\\{r_t\\}_{t=1}^T$ , let $\\bar r$ be the sample mean. Then the lag-1 autocorrelation of $r_t$ is $$\\hat\\rho_1 = \\frac{\\sum_{t=2}^T(r_t - \\bar r)(r_{t-1} - \\bar r)}{\\sum_{t=2}^T(r_t - \\bar r )^2}$$\n\nThe conditions under which $\\hat\\rho$ is a consistent estimator of $\\rho_1$ are as follows :\n\n-   The returns $\\{r_t\\}$ is an independent and identically distributed sequence\n-   $\\mathbb{E}(r_t^2) < \\infty$\n\nThen $\\hat\\rho_1$ is asymptotically normal with mean zero and variance 1/T\n\n<u>Testing</u>\n\nLet $H_0 : \\rho_1 = 0$ be the null hypothesis versus $H_a : \\rho_1 \\neq 0$ the alternative hypothesis. The test statistic is the usual t ratio (check the statistics section for further description) , which is $\\sqrt{T}\\hat\\rho_1$ and follows asymptotically the standard normal distribution. The null hypothesis $H_0$ is rejected if the t ratio is large in magnitude or equivalently , the p value of the t ratio is small , lets say less than 0.05\n\n\n::: {.cell hash='time_series_cache/html/unnamed-chunk-4_2f1cef0f2f99049360415610df27ac5e'}\n\n```{.r .cell-code}\nset.seed(666)\nphi = c(rep(0,11),.9)\nsAR = arima.sim(list(order=c(12,0,0), ar=phi), n=37)\nsAR = ts(sAR, freq=12)\nlayout(matrix(c(1,1,2, 1,1,3), nc=2))\npar(mar=c(3,3,2,1), mgp=c(1.6,.6,0))\nplot(sAR, axes=FALSE, main='seasonal AR(1)', xlab=\"year\", type='c')\nMonths = c(\"J\",\"F\",\"M\",\"A\",\"M\",\"J\",\"J\",\"A\",\"S\",\"O\",\"N\",\"D\") \npoints(sAR, pch=Months, cex=1.25, font=4, col=1:4)\naxis(1, 1:4); abline(v=1:4, lty=2, col=gray(.7))\naxis(2); box()\nACF = ARMAacf(ar=phi, ma=0, 100)\nPACF = ARMAacf(ar=phi, ma=0, 100, pacf=TRUE)\nplot(ACF,type=\"h\", xlab=\"LAG\", ylim=c(-.1,1)); abline(h=0) \nplot(PACF, type=\"h\", xlab=\"LAG\", ylim=c(-.1,1)); abline(h=0)\n```\n\n::: {.cell-output-display}\n![](time_series_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}